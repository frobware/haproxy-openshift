name: build flake and cache

on:
  push:
    branches:
      - main
    path: flake.nix

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: git checkout
        uses: actions/checkout@v3
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@main
      - name: Build
        run: |
          # Copied from https://www.reddit.com/r/NixOS/comments/vohopf/is_there_an_easy_way_to_build_all_the_packages_of/
          nix flake show --json | jq '.packages."x86_64-linux"|keys[]' | xargs -I {} echo nix build .#{}
